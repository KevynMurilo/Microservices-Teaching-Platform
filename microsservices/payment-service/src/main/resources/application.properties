# ==================================================
# APPLICATION
# ==================================================
spring.application.name=payment-service
server.port=8082

# ==================================================
# DATABASE (PostgreSQL - database-per-service pattern)
# ==================================================
spring.datasource.url=jdbc:postgresql://${DB_HOST:localhost}:${DB_PORT:5434}/paymentdb
spring.datasource.username=${DB_USERNAME:payment_user}
spring.datasource.password=${DB_PASSWORD:payment_pass}
spring.datasource.driver-class-name=org.postgresql.Driver

spring.jpa.hibernate.ddl-auto=validate
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect
spring.flyway.enabled=true
spring.flyway.locations=classpath:db/migration

# ==================================================
# RABBITMQ
# ==================================================
spring.rabbitmq.host=${SPRING_RABBITMQ_HOST:localhost}
spring.rabbitmq.port=5672
spring.rabbitmq.username=guest
spring.rabbitmq.password=guest

# Retry policy: if processing fails, Spring retries before giving up.
# After max-attempts, the message goes to the DLQ (configured in the queue args).
# Docs: https://www.rabbitmq.com/docs/dlx
spring.rabbitmq.listener.simple.retry.enabled=true
spring.rabbitmq.listener.simple.retry.initial-interval=2000
spring.rabbitmq.listener.simple.retry.max-attempts=3
spring.rabbitmq.listener.simple.retry.multiplier=2.0
spring.rabbitmq.listener.simple.default-requeue-rejected=false
spring.rabbitmq.listener.simple.observation-enabled=true

flash.rabbitmq.queue.order-created=orders.v1.queue
flash.rabbitmq.exchange.payments=payments.exchange
flash.rabbitmq.queue.payment-processed=payments.v1.queue
flash.rabbitmq.routing-key.payment-processed=payments.v1.processed

# ==================================================
# BUSINESS RULES
# ==================================================
flash.payment.max-amount=10000

# ==================================================
# OBSERVABILITY
# ==================================================
management.endpoints.web.exposure.include=health,info,metrics,prometheus
management.endpoint.health.show-details=always
management.metrics.tags.application=${spring.application.name}
management.tracing.sampling.probability=1.0
management.otlp.tracing.endpoint=http://${JAEGER_HOST:localhost}:4318/v1/traces

# ==================================================
# LOGGING
# ==================================================
logging.level.com.paymentservice=DEBUG
logging.level.org.springframework.amqp=INFO
